"use strict";function ownKeys(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,r)}return i}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(i),!0).forEach((function(t){_defineProperty(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function _defineProperty(e,t,i){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var r,l,o,s,a=[],n=!0,u=!1;try{if(o=(i=i.call(e)).next,0===t){if(Object(i)!==i)return;n=!1}else for(;!(n=(r=o.call(i)).done)&&(a.push(r.value),a.length!==t);n=!0);}catch(e){u=!0,l=e}finally{try{if(!n&&null!=i.return&&(s=i.return(),Object(s)!==s))return}finally{if(u)throw l}}return a}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var r=0,l=function(){};return{s:l,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,a=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return s=e.done,e},e:function(e){a=!0,o=e},f:function(){try{s||null==i.return||i.return()}finally{if(a)throw o}}}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==_typeof(t)?t:String(t)}function _toPrimitive(e,t){if("object"!=_typeof(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}var __defProp=Object.defineProperty,__defNormalProp=function(e,t,i){return t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i},__publicField=function(e,t,i){return __defNormalProp(e,"symbol"!=_typeof(t)?t+"":t,i),i};!function(e,t){"object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).JustValidate=t()}(void 0,(function(){var e=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,t=/^-?[0-9]\d*$/,i=/^(?=.*[A-Za-z])(?=.*\d).{8,}$/,r=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/,l=function(e){return"string"!=typeof e||""===e},o=function(e){return e.Required="required",e.Email="email",e.MinLength="minLength",e.MaxLength="maxLength",e.Password="password",e.Number="number",e.Integer="integer",e.MaxNumber="maxNumber",e.MinNumber="minNumber",e.StrongPassword="strongPassword",e.CustomRegexp="customRegexp",e.MinFilesCount="minFilesCount",e.MaxFilesCount="maxFilesCount",e.Files="files",e}(o||{}),s=function(e){return e.Required="required",e}(s||{}),a=function(e){return e.Label="label",e.LabelArrow="labelArrow",e}(a||{}),n=[{key:o.Required,dict:{en:"The field is required"}},{key:o.Email,dict:{en:"Email has invalid format"}},{key:o.MaxLength,dict:{en:"The field must contain a maximum of :value characters"}},{key:o.MinLength,dict:{en:"The field must contain a minimum of :value characters"}},{key:o.Password,dict:{en:"Password must contain minimum eight characters, at least one letter and one number"}},{key:o.StrongPassword,dict:{en:"Password should contain minimum eight characters, at least one uppercase letter, one lowercase letter, one number and one special character"}},{key:o.Number,dict:{en:"Value should be a number"}},{key:o.MaxNumber,dict:{en:"Number should be less or equal than :value"}},{key:o.MinNumber,dict:{en:"Number should be more or equal than :value"}},{key:o.MinFilesCount,dict:{en:"Files count should be more or equal than :value"}},{key:o.MaxFilesCount,dict:{en:"Files count should be less or equal than :value"}},{key:o.Files,dict:{en:"Uploaded files have one or several invalid properties (extension/size/type etc)."}}],u=function(e){return"object"==_typeof(e)&&null!==e&&"then"in e&&"function"==typeof e.then},d=function(e){return Array.isArray(e)?e.filter((function(e){return e.length>0})):"string"==typeof e&&e.trim()?_toConsumableArray(e.split(" ").filter((function(e){return e.length>0}))):[]},c=function(e){return e instanceof Element||e instanceof HTMLDocument},f={errorFieldStyle:{color:"#b81111",border:"1px solid #B81111"},errorFieldCssClass:"just-validate-error-field",successFieldCssClass:"just-validate-success-field",errorLabelStyle:{color:"#b81111"},errorLabelCssClass:"just-validate-error-label",successLabelCssClass:"just-validate-success-label",focusInvalidField:!0,lockForm:!0,testingMode:!1,validateBeforeSubmitting:!1,submitFormAutomatically:!1};return function(){function h(e,t,i){var r=this;_classCallCheck(this,h),__publicField(this,"form",null),__publicField(this,"fields",{}),__publicField(this,"groupFields",{}),__publicField(this,"errors",{}),__publicField(this,"isValid",!1),__publicField(this,"isSubmitted",!1),__publicField(this,"globalConfig",f),__publicField(this,"errorLabels",{}),__publicField(this,"successLabels",{}),__publicField(this,"eventListeners",[]),__publicField(this,"dictLocale",n),__publicField(this,"currentLocale","en"),__publicField(this,"customStyleTags",{}),__publicField(this,"onSuccessCallback"),__publicField(this,"onFailCallback"),__publicField(this,"onValidateCallback"),__publicField(this,"tooltips",[]),__publicField(this,"lastScrollPosition"),__publicField(this,"isScrollTick"),__publicField(this,"fieldIds",new Map),__publicField(this,"getKeyByFieldSelector",(function(e){return r.fieldIds.get(e)})),__publicField(this,"getFieldSelectorByKey",(function(e){var t,i=_createForOfIteratorHelper(r.fieldIds);try{for(i.s();!(t=i.n()).done;){var l=_slicedToArray(t.value,2),o=l[0];if(e===l[1])return o}}catch(e){i.e(e)}finally{i.f()}})),__publicField(this,"getCompatibleFields",(function(){var e={};return Object.keys(r.fields).forEach((function(t){var i=t,l=r.getFieldSelectorByKey(t);"string"==typeof l&&(i=l),e[i]=_objectSpread({},r.fields[t])})),e})),__publicField(this,"setKeyByFieldSelector",(function(e){if(r.fieldIds.has(e))return r.fieldIds.get(e);var t=String(r.fieldIds.size+1);return r.fieldIds.set(e,t),t})),__publicField(this,"refreshAllTooltips",(function(){r.tooltips.forEach((function(e){e.refresh()}))})),__publicField(this,"handleDocumentScroll",(function(){r.lastScrollPosition=window.scrollY,r.isScrollTick||(window.requestAnimationFrame((function(){r.refreshAllTooltips(),r.isScrollTick=!1})),r.isScrollTick=!0)})),__publicField(this,"formSubmitHandler",(function(e){e.preventDefault(),r.isSubmitted=!0,r.validateHandler(e)})),__publicField(this,"handleFieldChange",(function(e){var t;for(var i in r.fields)if(r.fields[i].elem===e){t=i;break}t&&(r.fields[t].touched=!0,r.validateField(t,!0))})),__publicField(this,"handleGroupChange",(function(e){var t;for(var i in r.groupFields)if(r.groupFields[i].elems.find((function(t){return t===e}))){t=i;break}t&&(r.groupFields[t].touched=!0,r.validateGroup(t,!0))})),__publicField(this,"handlerChange",(function(e){e.target&&(r.handleFieldChange(e.target),r.handleGroupChange(e.target),r.renderErrors())})),this.initialize(e,t,i)}return _createClass(h,[{key:"initialize",value:function(e,t,i){if(this.form=null,this.errors={},this.isValid=!1,this.isSubmitted=!1,this.globalConfig=f,this.errorLabels={},this.successLabels={},this.eventListeners=[],this.customStyleTags={},this.tooltips=[],this.currentLocale="en","string"==typeof e){var r=document.querySelector(e);if(!r)throw Error("Form with ".concat(e," selector not found! Please check the form selector"));this.setForm(r)}else{if(!(e instanceof HTMLFormElement))throw Error("Form selector is not valid. Please specify a string selector or a DOM element.");this.setForm(e)}if(this.globalConfig=_objectSpread(_objectSpread({},f),t),i&&(this.dictLocale=[].concat(_toConsumableArray(i),n)),this.isTooltip()){var l=document.createElement("style");l.textContent=".just-validate-error-label[data-tooltip=true]{position:fixed;padding:4px 8px;background:#423f3f;color:#fff;white-space:nowrap;z-index:10;border-radius:4px;transform:translateY(-5px)}.just-validate-error-label[data-tooltip=true]:before{content:'';width:0;height:0;border-left:solid 5px transparent;border-right:solid 5px transparent;border-bottom:solid 5px #423f3f;position:absolute;z-index:3;display:block;bottom:-5px;transform:rotate(180deg);left:calc(50% - 5px)}.just-validate-error-label[data-tooltip=true][data-direction=left]{transform:translateX(-5px)}.just-validate-error-label[data-tooltip=true][data-direction=left]:before{right:-7px;bottom:auto;left:auto;top:calc(50% - 2px);transform:rotate(90deg)}.just-validate-error-label[data-tooltip=true][data-direction=right]{transform:translateX(5px)}.just-validate-error-label[data-tooltip=true][data-direction=right]:before{right:auto;bottom:auto;left:-7px;top:calc(50% - 2px);transform:rotate(-90deg)}.just-validate-error-label[data-tooltip=true][data-direction=bottom]{transform:translateY(5px)}.just-validate-error-label[data-tooltip=true][data-direction=bottom]:before{right:auto;bottom:auto;left:calc(50% - 5px);top:-5px;transform:rotate(0)}",this.customStyleTags[a.Label]=document.head.appendChild(l),this.addListener("scroll",document,this.handleDocumentScroll)}}},{key:"getLocalisedString",value:function(e,t,i){var r,l=null!=i?i:e,s=null==(r=this.dictLocale.find((function(e){return e.key===l})))?void 0:r.dict[this.currentLocale];if(s||i&&(s=i),s&&void 0!==t)switch(e){case o.MaxLength:case o.MinLength:case o.MaxNumber:case o.MinNumber:case o.MinFilesCount:case o.MaxFilesCount:s=s.replace(":value",String(t))}return s||i||"Value is incorrect"}},{key:"getFieldErrorMessage",value:function(e,t){var i="function"==typeof e.errorMessage?e.errorMessage(this.getElemValue(t),this.fields):e.errorMessage;return this.getLocalisedString(e.rule,e.value,i)}},{key:"getFieldSuccessMessage",value:function(e,t){var i="function"==typeof e?e(this.getElemValue(t),this.fields):e;return this.getLocalisedString(void 0,void 0,i)}},{key:"getGroupErrorMessage",value:function(e){return this.getLocalisedString(e.rule,void 0,e.errorMessage)}},{key:"getGroupSuccessMessage",value:function(e){if(e.successMessage)return this.getLocalisedString(void 0,void 0,e.successMessage)}},{key:"setFieldInvalid",value:function(e,t){this.fields[e].isValid=!1,this.fields[e].errorMessage=this.getFieldErrorMessage(t,this.fields[e].elem)}},{key:"setFieldValid",value:function(e,t){this.fields[e].isValid=!0,void 0!==t&&(this.fields[e].successMessage=this.getFieldSuccessMessage(t,this.fields[e].elem))}},{key:"setGroupInvalid",value:function(e,t){this.groupFields[e].isValid=!1,this.groupFields[e].errorMessage=this.getGroupErrorMessage(t)}},{key:"setGroupValid",value:function(e,t){this.groupFields[e].isValid=!0,this.groupFields[e].successMessage=this.getGroupSuccessMessage(t)}},{key:"getElemValue",value:function(e){switch(e.type){case"checkbox":return e.checked;case"file":return e.files;default:return e.value}}},{key:"validateGroupRule",value:function(e,t,i){i.rule===s.Required&&(t.every((function(e){return!e.checked}))?this.setGroupInvalid(e,i):this.setGroupValid(e,i))}},{key:"validateFieldRule",value:function(s,a,n){var d,c=this,f=arguments.length>3&&void 0!==arguments[3]&&arguments[3],h=n.value,b=this.getElemValue(a);if(n.plugin)n.plugin(b,this.getCompatibleFields())||this.setFieldInvalid(s,n);else switch(n.rule){case o.Required:(function(e){var t=e;return"string"==typeof e&&(t=e.trim()),!t})(b)&&this.setFieldInvalid(s,n);break;case o.Email:if(l(b))break;d=b,e.test(d)||this.setFieldInvalid(s,n);break;case o.MaxLength:if(void 0===h){console.error("Value for ".concat(n.rule," rule for [").concat(s,"] field is not defined. The field will be always invalid.")),this.setFieldInvalid(s,n);break}if("number"!=typeof h){console.error("Value for ".concat(n.rule," rule for [").concat(s,"] should be a number. The field will be always invalid.")),this.setFieldInvalid(s,n);break}if(l(b))break;(function(e,t){return e.length>t})(b,h)&&this.setFieldInvalid(s,n);break;case o.MinLength:if(void 0===h){console.error("Value for ".concat(n.rule," rule for [").concat(s,"] field is not defined. The field will be always invalid.")),this.setFieldInvalid(s,n);break}if("number"!=typeof h){console.error("Value for ".concat(n.rule," rule for [").concat(s,"] should be a number. The field will be always invalid.")),this.setFieldInvalid(s,n);break}if(l(b))break;(function(e,t){return e.length<t})(b,h)&&this.setFieldInvalid(s,n);break;case o.Password:if(l(b))break;(function(e){return i.test(e)})(b)||this.setFieldInvalid(s,n);break;case o.StrongPassword:if(l(b))break;(function(e){return r.test(e)})(b)||this.setFieldInvalid(s,n);break;case o.Number:if(l(b))break;(function(e){return"string"==typeof e&&!isNaN(+e)&&!isNaN(parseFloat(e))})(b)||this.setFieldInvalid(s,n);break;case o.Integer:if(l(b))break;(function(e){return t.test(e)})(b)||this.setFieldInvalid(s,n);break;case o.MaxNumber:if(void 0===h){console.error("Value for ".concat(n.rule," rule for [").concat(s,"] field is not defined. The field will be always invalid.")),this.setFieldInvalid(s,n);break}if("number"!=typeof h){console.error("Value for ".concat(n.rule," rule for [").concat(s,"] field should be a number. The field will be always invalid.")),this.setFieldInvalid(s,n);break}if(l(b))break;var v=+b;(Number.isNaN(v)||function(e,t){return e>t}(v,h))&&this.setFieldInvalid(s,n);break;case o.MinNumber:if(void 0===h){console.error("Value for ".concat(n.rule," rule for [").concat(s,"] field is not defined. The field will be always invalid.")),this.setFieldInvalid(s,n);break}if("number"!=typeof h){console.error("Value for ".concat(n.rule," rule for [").concat(s,"] field should be a number. The field will be always invalid.")),this.setFieldInvalid(s,n);break}if(l(b))break;var y=+b;(Number.isNaN(y)||function(e,t){return e<t}(y,h))&&this.setFieldInvalid(s,n);break;case o.CustomRegexp:if(void 0===h)return console.error("Value for ".concat(n.rule," rule for [").concat(s,"] field is not defined. This field will be always invalid.")),void this.setFieldInvalid(s,n);var p;try{p=new RegExp(h)}catch(e){console.error("Value for ".concat(n.rule," rule for [").concat(s,"] should be a valid regexp. This field will be always invalid.")),this.setFieldInvalid(s,n);break}var g=String(b);""===g||p.test(g)||this.setFieldInvalid(s,n);break;case o.MinFilesCount:if(void 0===h){console.error("Value for ".concat(n.rule," rule for [").concat(s,"] field is not defined. This field will be always invalid.")),this.setFieldInvalid(s,n);break}if("number"!=typeof h){console.error("Value for ".concat(n.rule," rule for [").concat(s,"] field should be a number. The field will be always invalid.")),this.setFieldInvalid(s,n);break}if(Number.isFinite(null==b?void 0:b.length)&&b.length<h){this.setFieldInvalid(s,n);break}break;case o.MaxFilesCount:if(void 0===h){console.error("Value for ".concat(n.rule," rule for [").concat(s,"] field is not defined. This field will be always invalid.")),this.setFieldInvalid(s,n);break}if("number"!=typeof h){console.error("Value for ".concat(n.rule," rule for [").concat(s,"] field should be a number. The field will be always invalid.")),this.setFieldInvalid(s,n);break}if(Number.isFinite(null==b?void 0:b.length)&&b.length>h){this.setFieldInvalid(s,n);break}break;case o.Files:if(void 0===h)return console.error("Value for ".concat(n.rule," rule for [").concat(s,"] field is not defined. This field will be always invalid.")),void this.setFieldInvalid(s,n);if("object"!=_typeof(h))return console.error("Value for ".concat(n.rule," rule for [").concat(s,"] field should be an object. This field will be always invalid.")),void this.setFieldInvalid(s,n);var m=h.files;if("object"!=_typeof(m))return console.error("Value for ".concat(n.rule," rule for [").concat(s,"] field should be an object with files array. This field will be always invalid.")),void this.setFieldInvalid(s,n);var F=function(e,t){var i=Number.isFinite(t.minSize)&&e.size<t.minSize,r=Number.isFinite(t.maxSize)&&e.size>t.maxSize,l=Array.isArray(t.names)&&!t.names.includes(e.name),o=Array.isArray(t.extensions)&&!t.extensions.includes(e.name.split(".")[e.name.split(".").length-1]),s=Array.isArray(t.types)&&!t.types.includes(e.type);return i||r||l||o||s};if("object"==_typeof(b)&&null!==b)for(var k=0,C=b.length;k<C;++k){var _=b.item(k);if(!_){this.setFieldInvalid(s,n);break}if(F(_,m)){this.setFieldInvalid(s,n);break}}break;default:if("function"!=typeof n.validator)return console.error("Validator for custom rule for [".concat(s,"] field should be a function. This field will be always invalid.")),void this.setFieldInvalid(s,n);var S=n.validator(b,this.getCompatibleFields());if("boolean"!=typeof S&&"function"!=typeof S&&console.error("Validator return value for [".concat(s,"] field should be boolean or function. It will be cast to boolean.")),"function"==typeof S){if(!f){this.fields[s].asyncCheckPending=!1;var w=S();return u(w)?w.then((function(e){e||c.setFieldInvalid(s,n)})).catch((function(){c.setFieldInvalid(s,n)})):(console.error("Validator function for custom rule for [".concat(s,"] field should return a Promise. This field will be always invalid.")),void this.setFieldInvalid(s,n))}this.fields[s].asyncCheckPending=!0}S||this.setFieldInvalid(s,n)}}},{key:"isFormValid",value:function(){for(var e=!0,t=0,i=Object.values(this.fields).length;t<i;++t){var r=Object.values(this.fields)[t];if(void 0===r.isValid){e=void 0;break}if(!1===r.isValid){e=!1;break}}for(var l=0,o=Object.values(this.groupFields).length;l<o;++l){var s=Object.values(this.groupFields)[l];if(void 0===s.isValid){e=void 0;break}if(!1===s.isValid){e=!1;break}}return e}},{key:"validateField",value:function(e){var t,i=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=this.fields[e];l.isValid=!0;var o=[];return _toConsumableArray(l.rules).reverse().forEach((function(t){var s=i.validateFieldRule(e,l.elem,t,r);u(s)&&o.push(s)})),l.isValid&&this.setFieldValid(e,null==(t=l.config)?void 0:t.successMessage),Promise.allSettled(o).finally((function(){var e;r&&(null==(e=i.onValidateCallback)||e.call(i,{isValid:i.isFormValid(),isSubmitted:i.isSubmitted,fields:i.getCompatibleFields(),groups:_objectSpread({},i.groupFields)}))}))}},{key:"revalidateField",value:function(e){var t=this;if("string"!=typeof e&&!c(e))throw Error("Field selector is not valid. Please specify a string selector or a valid DOM element.");var i=this.getKeyByFieldSelector(e);return i&&this.fields[i]?new Promise((function(e){t.validateField(i,!0).finally((function(){t.clearFieldStyle(i),t.clearFieldLabel(i),t.renderFieldError(i,!0),e(!!t.fields[i].isValid)}))})):(console.error("Field not found. Check the field selector."),Promise.reject())}},{key:"revalidateGroup",value:function(e){var t=this;if("string"!=typeof e&&!c(e))throw Error("Group selector is not valid. Please specify a string selector or a valid DOM element.");var i=this.getKeyByFieldSelector(e);return i&&this.groupFields[i]?new Promise((function(e){t.validateGroup(i).finally((function(){t.clearFieldLabel(i),t.renderGroupError(i,!0),e(!!t.groupFields[i].isValid)}))})):(console.error("Group not found. Check the group selector."),Promise.reject())}},{key:"validateGroup",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.groupFields[e],l=[];return _toConsumableArray(r.rules).reverse().forEach((function(i){var o=t.validateGroupRule(e,r.elems,i);u(o)&&l.push(o)})),Promise.allSettled(l).finally((function(){var e;i&&(null==(e=t.onValidateCallback)||e.call(t,{isValid:t.isFormValid(),isSubmitted:t.isSubmitted,fields:t.getCompatibleFields(),groups:_objectSpread({},t.groupFields)}))}))}},{key:"focusInvalidField",value:function(){var e=this,t=function(){var t=e.fields[i];if(!t.isValid)return setTimeout((function(){return t.elem.focus()}),0),1};for(var i in this.fields)if(t())break}},{key:"afterSubmitValidation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.renderErrors(e),this.globalConfig.focusInvalidField&&this.focusInvalidField()}},{key:"validate",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((function(i){var r=[];Object.keys(e.fields).forEach((function(t){var i=e.validateField(t);u(i)&&r.push(i)})),Object.keys(e.groupFields).forEach((function(t){var i=e.validateGroup(t);u(i)&&r.push(i)})),Promise.allSettled(r).then((function(){var l;e.afterSubmitValidation(t),null==(l=e.onValidateCallback)||l.call(e,{isValid:e.isFormValid(),isSubmitted:e.isSubmitted,fields:e.getCompatibleFields(),groups:_objectSpread({},e.groupFields)}),i(!!r.length)}))}))}},{key:"revalidate",value:function(){var e=this;return new Promise((function(t){e.validateHandler(void 0,!0).finally((function(){e.globalConfig.focusInvalidField&&e.focusInvalidField(),t(e.isValid)}))}))}},{key:"validateHandler",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.globalConfig.lockForm&&this.lockForm(),this.validate(i).finally((function(){var i,r,l;t.globalConfig.lockForm&&t.unlockForm(),t.isValid?(null==(i=t.onSuccessCallback)||i.call(t,e),t.globalConfig.submitFormAutomatically&&(null==(r=null==e?void 0:e.currentTarget)||r.submit())):null==(l=t.onFailCallback)||l.call(t,t.getCompatibleFields(),t.groupFields)}))}},{key:"setForm",value:function(e){this.form=e,this.form.setAttribute("novalidate","novalidate"),this.removeListener("submit",this.form,this.formSubmitHandler),this.addListener("submit",this.form,this.formSubmitHandler)}},{key:"addListener",value:function(e,t,i){t.addEventListener(e,i),this.eventListeners.push({type:e,elem:t,func:i})}},{key:"removeListener",value:function(e,t,i){t.removeEventListener(e,i),this.eventListeners=this.eventListeners.filter((function(i){return i.type!==e||i.elem!==t}))}},{key:"addField",value:function(e,t,i){if("string"!=typeof e&&!c(e))throw Error("Field selector is not valid. Please specify a string selector or a valid DOM element.");var r;if(!(r="string"==typeof e?this.form.querySelector(e):e))throw Error("Field doesn't exist in the DOM! Please check the field selector.");if(!Array.isArray(t)||!t.length)throw Error("Rules argument should be an array and should contain at least 1 element.");t.forEach((function(e){if(!("rule"in e||"validator"in e||"plugin"in e))throw Error("Rules argument must contain at least one rule or validator property.");if(!(e.validator||e.plugin||e.rule&&Object.values(o).includes(e.rule)))throw Error("Rule should be one of these types: ".concat(Object.values(o).join(", "),". Provided value: ").concat(e.rule))}));var l=this.setKeyByFieldSelector(e);return this.fields[l]={elem:r,rules:t,isValid:void 0,touched:!1,config:i},this.setListeners(r),(this.isSubmitted||this.globalConfig.validateBeforeSubmitting)&&this.validateField(l),this}},{key:"removeField",value:function(e){if("string"!=typeof e&&!c(e))throw Error("Field selector is not valid. Please specify a string selector or a valid DOM element.");var t=this.getKeyByFieldSelector(e);if(!t||!this.fields[t])return console.error("Field not found. Check the field selector."),this;var i=this.getListenerType(this.fields[t].elem.type);return this.removeListener(i,this.fields[t].elem,this.handlerChange),this.clearErrors(),delete this.fields[t],this}},{key:"removeGroup",value:function(e){var t=this;if("string"!=typeof e)throw Error("Group selector is not valid. Please specify a string selector.");var i=this.getKeyByFieldSelector(e);return i&&this.groupFields[i]?(this.groupFields[i].elems.forEach((function(e){var i=t.getListenerType(e.type);t.removeListener(i,e,t.handlerChange)})),this.clearErrors(),delete this.groupFields[i],this):(console.error("Group not found. Check the group selector."),this)}},{key:"addRequiredGroup",value:function(e,t,i,r){var l,o=this;if("string"!=typeof e&&!c(e))throw Error("Group selector is not valid. Please specify a string selector or a valid DOM element.");if(!(l="string"==typeof e?this.form.querySelector(e):e))throw Error("Group selector not found! Please check the group selector.");var a=l.querySelectorAll("input"),n=Array.from(a).filter((function(e){var t=function(e,t){for(var i=_toConsumableArray(t).reverse(),r=0,l=i.length;r<l;++r){var o=i[r];for(var s in e){var a=e[s];if(a.groupElem===o)return[s,a]}}return null}(o.groupFields,function(e){for(var t=e,i=[];t;)i.unshift(t),t=t.parentNode;return i}(e));return!t||t[1].elems.find((function(t){return t!==e}))})),u=this.setKeyByFieldSelector(e);return this.groupFields[u]={rules:[{rule:s.Required,errorMessage:t,successMessage:r}],groupElem:l,elems:n,touched:!1,isValid:void 0,config:i},a.forEach((function(e){o.setListeners(e)})),this}},{key:"getListenerType",value:function(e){switch(e){case"checkbox":case"select-one":case"file":case"radio":return"change";default:return"input"}}},{key:"setListeners",value:function(e){var t=this.getListenerType(e.type);this.removeListener(t,e,this.handlerChange),this.addListener(t,e,this.handlerChange)}},{key:"clearFieldLabel",value:function(e){var t,i;null==(t=this.errorLabels[e])||t.remove(),null==(i=this.successLabels[e])||i.remove()}},{key:"clearFieldStyle",value:function(e){var t,i,r,l,o,s=this.fields[e],a=(null==(i=s.config)?void 0:i.errorFieldStyle)||this.globalConfig.errorFieldStyle;Object.keys(a).forEach((function(e){s.elem.style[e]=""}));var n=(null==(r=s.config)?void 0:r.successFieldStyle)||this.globalConfig.successFieldStyle||{};Object.keys(n).forEach((function(e){s.elem.style[e]=""})),(t=s.elem.classList).remove.apply(t,_toConsumableArray(d((null==(l=s.config)?void 0:l.errorFieldCssClass)||this.globalConfig.errorFieldCssClass)).concat(_toConsumableArray(d((null==(o=s.config)?void 0:o.successFieldCssClass)||this.globalConfig.successFieldCssClass))))}},{key:"clearErrors",value:function(){var e,t,i=this;for(var r in Object.keys(this.errorLabels).forEach((function(e){return i.errorLabels[e].remove()})),Object.keys(this.successLabels).forEach((function(e){return i.successLabels[e].remove()})),this.fields)this.clearFieldStyle(r);var l=function(){var r=i.groupFields[o],l=(null==(e=r.config)?void 0:e.errorFieldStyle)||i.globalConfig.errorFieldStyle;Object.keys(l).forEach((function(e){r.elems.forEach((function(t){var l,o;t.style[e]="",(l=t.classList).remove.apply(l,_toConsumableArray(d((null==(o=r.config)?void 0:o.errorFieldCssClass)||i.globalConfig.errorFieldCssClass)))}))}));var s=(null==(t=r.config)?void 0:t.successFieldStyle)||i.globalConfig.successFieldStyle||{};Object.keys(s).forEach((function(e){r.elems.forEach((function(t){var l,o;t.style[e]="",(l=t.classList).remove.apply(l,_toConsumableArray(d((null==(o=r.config)?void 0:o.successFieldCssClass)||i.globalConfig.successFieldCssClass)))}))}))};for(var o in this.groupFields)l();this.tooltips=[]}},{key:"isTooltip",value:function(){return!!this.globalConfig.tooltip}},{key:"lockForm",value:function(){for(var e=this.form.querySelectorAll("input, textarea, button, select"),t=0,i=e.length;t<i;++t)e[t].setAttribute("data-just-validate-fallback-disabled",e[t].disabled?"true":"false"),e[t].setAttribute("disabled","disabled"),e[t].style.pointerEvents="none",e[t].style.webkitFilter="grayscale(100%)",e[t].style.filter="grayscale(100%)"}},{key:"unlockForm",value:function(){for(var e=this.form.querySelectorAll("input, textarea, button, select"),t=0,i=e.length;t<i;++t)"true"!==e[t].getAttribute("data-just-validate-fallback-disabled")&&e[t].removeAttribute("disabled"),e[t].style.pointerEvents="",e[t].style.webkitFilter="",e[t].style.filter=""}},{key:"renderTooltip",value:function(e,t,i){var r,l=this,o=e.getBoundingClientRect(),s=o.top,a=o.left,n=o.width,u=o.height,d=t.getBoundingClientRect(),c=i||(null==(r=this.globalConfig.tooltip)?void 0:r.position);switch(c){case"left":t.style.top=s+u/2-d.height/2+"px",t.style.left=a-d.width-5+"px";break;case"top":t.style.top=s-d.height-5+"px",t.style.left=a+n/2-d.width/2+"px";break;case"right":t.style.top=s+u/2-d.height/2+"px",t.style.left="".concat(a+n+5,"px");break;case"bottom":t.style.top="".concat(s+u+5,"px"),t.style.left=a+n/2-d.width/2+"px"}return t.dataset.direction=c,{refresh:function(){l.renderTooltip(e,t,i)}}}},{key:"createErrorLabelElem",value:function(e,t,i){var r,l=document.createElement("div");l.innerHTML=t;var o=this.isTooltip()?null==i?void 0:i.errorLabelStyle:(null==i?void 0:i.errorLabelStyle)||this.globalConfig.errorLabelStyle;return Object.assign(l.style,o),(r=l.classList).add.apply(r,_toConsumableArray(d((null==i?void 0:i.errorLabelCssClass)||this.globalConfig.errorLabelCssClass)).concat(["just-validate-error-label"])),this.isTooltip()&&(l.dataset.tooltip="true"),this.globalConfig.testingMode&&(l.dataset.testId="error-label-".concat(e)),this.errorLabels[e]=l,l}},{key:"createSuccessLabelElem",value:function(e,t,i){var r;if(void 0===t)return null;var l=document.createElement("div");l.innerHTML=t;var o=(null==i?void 0:i.successLabelStyle)||this.globalConfig.successLabelStyle;return Object.assign(l.style,o),(r=l.classList).add.apply(r,_toConsumableArray(d((null==i?void 0:i.successLabelCssClass)||this.globalConfig.successLabelCssClass)).concat(["just-validate-success-label"])),this.globalConfig.testingMode&&(l.dataset.testId="success-label-".concat(e)),this.successLabels[e]=l,l}},{key:"renderErrorsContainer",value:function(e,t){var i=t||this.globalConfig.errorsContainer;if("string"==typeof i){var r=this.form.querySelector(i);if(r)return r.appendChild(e),!0;console.error("Error container with ".concat(i," selector not found. Errors will be rendered as usual"))}return i instanceof Element?(i.appendChild(e),!0):(void 0!==i&&console.error("Error container not found. It should be a string or existing Element. Errors will be rendered as usual"),!1)}},{key:"renderGroupLabel",value:function(e,t,i,r){!r&&this.renderErrorsContainer(t,i)||e.appendChild(t)}},{key:"renderFieldLabel",value:function(e,t,i,r){var l,o,s,a,n,u,d;if(r||!this.renderErrorsContainer(t,i))if("checkbox"===e.type||"radio"===e.type){var c=document.querySelector('label[for="'.concat(e.getAttribute("id"),'"]'));"label"===(null==(o=null==(l=e.parentElement)?void 0:l.tagName)?void 0:o.toLowerCase())?null==(a=null==(s=e.parentElement)?void 0:s.parentElement)||a.appendChild(t):c?null==(n=c.parentElement)||n.appendChild(t):null==(u=e.parentElement)||u.appendChild(t)}else null==(d=e.parentElement)||d.appendChild(t)}},{key:"showLabels",value:function(e,t){var i=this;Object.keys(e).forEach((function(r,l){var o=e[r],s=i.getKeyByFieldSelector(r);if(s&&i.fields[s]){var a=i.fields[s];a.isValid=!t,i.clearFieldStyle(s),i.clearFieldLabel(s),i.renderFieldError(s,!1,o),0===l&&i.globalConfig.focusInvalidField&&setTimeout((function(){return a.elem.focus()}),0)}else console.error("Field not found. Check the field selector.")}))}},{key:"showErrors",value:function(e){if("object"!=_typeof(e))throw Error("[showErrors]: Errors should be an object with key: value format");this.showLabels(e,!0)}},{key:"showSuccessLabels",value:function(e){if("object"!=_typeof(e))throw Error("[showSuccessLabels]: Labels should be an object with key: value format");this.showLabels(e,!1)}},{key:"renderFieldError",value:function(e){var t,i,r,l,o,s,a,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],u=arguments.length>2?arguments[2]:void 0,c=this.fields[e];if(!1===c.isValid&&(this.isValid=!1),void 0!==c.isValid&&(n||this.isSubmitted||c.touched||void 0!==u))if(c.isValid){if(!c.asyncCheckPending){var f,h=this.createSuccessLabelElem(e,void 0!==u?u:c.successMessage,c.config);h&&this.renderFieldLabel(c.elem,h,null==(i=c.config)?void 0:i.errorsContainer,!0),(f=c.elem.classList).add.apply(f,_toConsumableArray(d((null==(r=c.config)?void 0:r.successFieldCssClass)||this.globalConfig.successFieldCssClass)))}}else{(t=c.elem.classList).add.apply(t,_toConsumableArray(d((null==(l=c.config)?void 0:l.errorFieldCssClass)||this.globalConfig.errorFieldCssClass)));var b=this.createErrorLabelElem(e,void 0!==u?u:c.errorMessage,c.config);this.renderFieldLabel(c.elem,b,null==(o=c.config)?void 0:o.errorsContainer),this.isTooltip()&&this.tooltips.push(this.renderTooltip(c.elem,b,null==(a=null==(s=c.config)?void 0:s.tooltip)?void 0:a.position))}}},{key:"renderGroupError",value:function(e){var t,i,r,l,o=this,s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this.groupFields[e];if(!1===a.isValid&&(this.isValid=!1),void 0!==a.isValid&&(s||this.isSubmitted||a.touched))if(a.isValid){a.elems.forEach((function(e){var t,i,r;Object.assign(e.style,(null==(i=a.config)?void 0:i.successFieldStyle)||o.globalConfig.successFieldStyle),(t=e.classList).add.apply(t,_toConsumableArray(d((null==(r=a.config)?void 0:r.successFieldCssClass)||o.globalConfig.successFieldCssClass)))}));var n=this.createSuccessLabelElem(e,a.successMessage,a.config);n&&this.renderGroupLabel(a.groupElem,n,null==(t=a.config)?void 0:t.errorsContainer,!0)}else{this.isValid=!1,a.elems.forEach((function(e){var t,i,r;Object.assign(e.style,(null==(i=a.config)?void 0:i.errorFieldStyle)||o.globalConfig.errorFieldStyle),(t=e.classList).add.apply(t,_toConsumableArray(d((null==(r=a.config)?void 0:r.errorFieldCssClass)||o.globalConfig.errorFieldCssClass)))}));var u=this.createErrorLabelElem(e,a.errorMessage,a.config);this.renderGroupLabel(a.groupElem,u,null==(i=a.config)?void 0:i.errorsContainer),this.isTooltip()&&this.tooltips.push(this.renderTooltip(a.groupElem,u,null==(l=null==(r=a.config)?void 0:r.tooltip)?void 0:l.position))}}},{key:"renderErrors",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isSubmitted||e||this.globalConfig.validateBeforeSubmitting){for(var t in this.clearErrors(),this.isValid=!0,this.groupFields)this.renderGroupError(t);for(var i in this.fields)this.renderFieldError(i)}}},{key:"destroy",value:function(){var e=this;this.eventListeners.forEach((function(t){e.removeListener(t.type,t.elem,t.func)})),Object.keys(this.customStyleTags).forEach((function(t){e.customStyleTags[t].remove()})),this.clearErrors(),this.globalConfig.lockForm&&this.unlockForm()}},{key:"refresh",value:function(){var e=this;this.destroy(),this.form?(this.initialize(this.form,this.globalConfig),Object.keys(this.fields).forEach((function(t){var i=e.getFieldSelectorByKey(t);i&&e.addField(i,_toConsumableArray(e.fields[t].rules),e.fields[t].config)}))):console.error("Cannot initialize the library! Form is not defined")}},{key:"setCurrentLocale",value:function(e){"string"==typeof e||void 0===e?(this.currentLocale=e,this.isSubmitted&&this.validate()):console.error("Current locale should be a string")}},{key:"onSuccess",value:function(e){return this.onSuccessCallback=e,this}},{key:"onFail",value:function(e){return this.onFailCallback=e,this}},{key:"onValidate",value:function(e){return this.onValidateCallback=e,this}}]),h}()}));
//# sourceMappingURL=just-validate.js.map
